<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>CompilerMonad (JaML.Jaml_lib.Monads.CompilerMonad)</title><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.3.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">JaML</a> &#x00BB; <a href="../../index.html">Jaml_lib</a> &#x00BB; <a href="../index.html">Monads</a> &#x00BB; CompilerMonad</nav><header class="odoc-preamble"><h1>Module <code><span>Monads.CompilerMonad</span></code></h1><p>The monad is actually a large result-state monad, which encapsulates some of complexities of generating an assembler for an x86-64 machine. The monad works accoring to SYSTEM V ABI calling conventions.</p><p>See https://refspecs.linuxbase.org/elf/x86_64-abi-0.99.pdf 3.2 Function Calling Sequence for reference.</p><p>What parts of calling convenction are handeled:</p><ol><li>First six arguments are passed via registers and others arguments are pushed on stack.</li><li>Monad do care about stack alignment by 16 before making function call.</li><li>Monad do save caller save registers except RAX. Monad user has to save it excplicetly himself.</li></ol><p>What parts of calling convenciton are not handled:</p><ol><li>Callee save registers do not save.</li></ol><p>What benefits are offered by the monad:</p><ol><li>Monad encapsulate working with stack. User does not have access to RBS, RSP registers. Also he does not have access to push and pop commands. All stack work is done by monad.</li><li>Monad introduce user abstraction -- variable. It can be saved using the command: <code>let* cmd = save_return_value my_var</code></li><li>Monad takes care of the saved variables and prevents the user from accidentally overwriting them.</li><li>Monad prohibits the user from exiting a function twice and creating a function twice in a row without using doing function exit.</li></ol></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-register"><a href="#type-register" class="anchor"></a><code><span><span class="keyword">type</span> register</span></code></div><div class="spec-doc"><p>The type represents registers: rax, rbx, rcx, ...</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-label"><a href="#type-label" class="anchor"></a><code><span><span class="keyword">type</span> label</span></code></div><div class="spec-doc"><p>The type represents assembly labels</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-asm_value"><a href="#type-asm_value" class="anchor"></a><code><span><span class="keyword">type</span> asm_value</span></code></div><div class="spec-doc"><p>The type represent all values from assembly: labels, memory, registers</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-command"><a href="#type-command" class="anchor"></a><code><span><span class="keyword">type</span> command</span></code></div><div class="spec-doc"><p>Represent assembly mnemonic with operands</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span></code></div><div class="spec-doc"><p>Returned from monad error</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'error) t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Print error</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span><span class="type-var">'error</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-let*"><a href="#val-let*" class="anchor"></a><code><span><span class="keyword">val</span> let* : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fresh"><a href="#val-fresh" class="anchor"></a><code><span><span class="keyword">val</span> fresh : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(string, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-monad_map"><a href="#val-monad_map" class="anchor"></a><code><span><span class="keyword">val</span> monad_map : <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> list</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'error</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-R"><a href="#module-R" class="anchor"></a><code><span><span class="keyword">module</span> <a href="R/index.html">R</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Registers available for monad user</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty_cmd"><a href="#val-empty_cmd" class="anchor"></a><code><span><span class="keyword">val</span> empty_cmd : <a href="#type-command">command</a></span></code></div><div class="spec-doc"><p>Just empty command which does nothing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mov_cmd"><a href="#val-mov_cmd" class="anchor"></a><code><span><span class="keyword">val</span> mov_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create mov mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_cmd"><a href="#val-add_cmd" class="anchor"></a><code><span><span class="keyword">val</span> add_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create add mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub_cmd"><a href="#val-sub_cmd" class="anchor"></a><code><span><span class="keyword">val</span> sub_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create sum mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-idiv_cmd"><a href="#val-idiv_cmd" class="anchor"></a><code><span><span class="keyword">val</span> idiv_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create idiv mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-imul_cmd"><a href="#val-imul_cmd" class="anchor"></a><code><span><span class="keyword">val</span> imul_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create imul mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-xor_cmd"><a href="#val-xor_cmd" class="anchor"></a><code><span><span class="keyword">val</span> xor_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create xor mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-and_cmd"><a href="#val-and_cmd" class="anchor"></a><code><span><span class="keyword">val</span> and_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create and mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-or_cmd"><a href="#val-or_cmd" class="anchor"></a><code><span><span class="keyword">val</span> or_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create or mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cmp_cmd"><a href="#val-cmp_cmd" class="anchor"></a><code><span><span class="keyword">val</span> cmp_cmd : 
  <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create cmp mnemonic with two operands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sete_cmd"><a href="#val-sete_cmd" class="anchor"></a><code><span><span class="keyword">val</span> sete_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setemnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setne_cmd"><a href="#val-setne_cmd" class="anchor"></a><code><span><span class="keyword">val</span> setne_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setne mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setg_cmd"><a href="#val-setg_cmd" class="anchor"></a><code><span><span class="keyword">val</span> setg_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setg mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setl_cmd"><a href="#val-setl_cmd" class="anchor"></a><code><span><span class="keyword">val</span> setl_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setl mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setge_cmd"><a href="#val-setge_cmd" class="anchor"></a><code><span><span class="keyword">val</span> setge_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setge mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setle_cmd"><a href="#val-setle_cmd" class="anchor"></a><code><span><span class="keyword">val</span> setle_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create setle mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jmp_cmd"><a href="#val-jmp_cmd" class="anchor"></a><code><span><span class="keyword">val</span> jmp_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create jmp mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jne_cmd"><a href="#val-jne_cmd" class="anchor"></a><code><span><span class="keyword">val</span> jne_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create jne mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-je_cmd"><a href="#val-je_cmd" class="anchor"></a><code><span><span class="keyword">val</span> je_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create je mnemonic with one operand</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cqo_cmd"><a href="#val-cqo_cmd" class="anchor"></a><code><span><span class="keyword">val</span> cqo_cmd : <span><span class="optlabel">?comment</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_comment"><a href="#val-make_comment" class="anchor"></a><code><span><span class="keyword">val</span> make_comment : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create assembler comment</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_global"><a href="#val-add_global" class="anchor"></a><code><span><span class="keyword">val</span> add_global : <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create global declaration</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_extern"><a href="#val-add_extern" class="anchor"></a><code><span><span class="keyword">val</span> add_extern : <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create extern declaration. All extern functions must be declared using THIS command.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_label"><a href="#val-make_label" class="anchor"></a><code><span><span class="keyword">val</span> make_label : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-label">label</a>, <span class="type-var">'error</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Convert string to label type. And add the label to the environment</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_bool"><a href="#val-make_bool" class="anchor"></a><code><span><span class="keyword">val</span> make_bool : <span>bool <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-asm_value">asm_value</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Convert bool value to asm_value</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_integer"><a href="#val-make_integer" class="anchor"></a><code><span><span class="keyword">val</span> make_integer : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-asm_value">asm_value</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Convert integer value to asm_value</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-label_to_asmvalue"><a href="#val-label_to_asmvalue" class="anchor"></a><code><span><span class="keyword">val</span> label_to_asmvalue : <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-asm_value">asm_value</a></span></code></div><div class="spec-doc"><p>Convert label to asm_value</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reg_to_asmvalue"><a href="#val-reg_to_asmvalue" class="anchor"></a><code><span><span class="keyword">val</span> reg_to_asmvalue : <span><a href="#type-register">register</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-asm_value">asm_value</a></span></code></div><div class="spec-doc"><p>Convert register to asm_value</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_data_from_environment"><a href="#val-get_data_from_environment" class="anchor"></a><code><span><span class="keyword">val</span> get_data_from_environment : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a> * <a href="#type-asm_value">asm_value</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Used to get variable or saved label</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_label_cmd"><a href="#val-make_label_cmd" class="anchor"></a><code><span><span class="keyword">val</span> make_label_cmd : <span><a href="#type-label">label</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create command form label. For example main label can be declared using the command.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_func_call"><a href="#val-make_func_call" class="anchor"></a><code><span><span class="keyword">val</span> make_func_call : <span><a href="#type-asm_value">asm_value</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-asm_value">asm_value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Takes function and her argument and make call. Before call:</p><ol><li>All arguments are passed according to SYSTEM V ABI calling convenction.</li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_func_preambula"><a href="#val-make_func_preambula" class="anchor"></a><code><span><span class="keyword">val</span> make_func_preambula : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Make function preambula: save old rsp register, bind all arguments to the stack/registers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_func_ret"><a href="#val-make_func_ret" class="anchor"></a><code><span><span class="keyword">val</span> make_func_ret : <span><span>(<span><a href="#type-command">command</a> list</span>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Make exit from the function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_return_value"><a href="#val-save_return_value" class="anchor"></a><code><span><span class="keyword">val</span> save_return_value : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-command">command</a>, <a href="#type-error">error</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>The function can be used to bind any value stored in rax to the variable. After binding you don't have to be scared of lossing variable by writing something at rax. Monad will protected binding variable from owerriting and if necessary will place it on stack from register. Binded vatiable can be obtained using <code>get_data_from_environment</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commands_to_str"><a href="#val-commands_to_str" class="anchor"></a><code><span><span class="keyword">val</span> commands_to_str : <span><span><a href="#type-command">command</a> list</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Converts all commands to string</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_commands"><a href="#val-pp_commands" class="anchor"></a><code><span><span class="keyword">val</span> pp_commands : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-command">command</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Print commands</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commands_to_file"><a href="#val-commands_to_file" class="anchor"></a><code><span><span class="keyword">val</span> commands_to_file : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-command">command</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Save commands to specified file</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start_branch"><a href="#val-start_branch" class="anchor"></a><code><span><span class="keyword">val</span> start_branch : <span><span>(unit, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Should be called before 'then' or 'else' branch</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_branch"><a href="#val-end_branch" class="anchor"></a><code><span><span class="keyword">val</span> end_branch : <span><span>(unit, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Should be called after 'then' or 'else' branch</p></div></div></div></body></html>
